<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>EasyQue — Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f3f6fb}
    .wrap{max-width:420px;margin:80px auto;background:#fff;padding:22px;border-radius:8px;border:1px solid #eee}
    h1{margin:0 0 12px}
    label{display:block;margin-top:12px;font-weight:600}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:6px}
    button{background:#0b74de;color:#fff;padding:10px;border-radius:8px;border:0;margin-top:12px;cursor:pointer}
    .muted{color:#666;margin-top:10px}
    .error{color:#b00020;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>EasyQue — Login</h1>
    <div>
      <label>Email</label>
      <input id="email" type="email" value="easyque0@gmail.com">
      <label>Password</label>
      <input id="password" type="password" value="Mylefin@141">
      <button id="btnLogin">Login</button>
      <div id="msg" class="muted">Need an account? <a href="signup-now.html">Sign up</a></div>
      <div id="error" class="error" style="display:none"></div>
    </div>
  </div>

<script>
document.getElementById('btnLogin').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const errEl = document.getElementById('error');
  errEl.style.display = 'none';
  if (!email || !password) { errEl.textContent = 'Email and password required'; errEl.style.display='block'; return; }
  try {
    const r = await fetch('/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const txt = await r.text();
    const ct = r.headers.get('content-type') || '';
    let j = null;
    if (ct.indexOf('application/json') !== -1) j = JSON.parse(txt);
    else {
      errEl.textContent = 'Server returned non-json: ' + txt;
      errEl.style.display = 'block';
      return;
    }
    if (!r.ok || !j.ok) {
      errEl.textContent = (j && j.error) || 'Login failed';
      errEl.style.display = 'block';
      return;
    }
    // save token and redirect
    if (j.accessToken) localStorage.setItem('accessToken', j.accessToken);
    if (j.user) localStorage.setItem('user', JSON.stringify(j.user));
    window.location.href = 'bookings.html';
  } catch (e) {
    errEl.textContent = 'Login error: ' + (e && e.message || e);
    errEl.style.display = 'block';
  }
});
</script>
</body>
</html>
